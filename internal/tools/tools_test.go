package tools

import (
	"encoding/json"
	"testing"
)

func TestMd5(t *testing.T) {
	md5Str := "202cb962ac59075b964b07152d234b70"
	if Md5("123") != md5Str {
		t.Errorf("md5 fail")
	}
	t.Log(Md5("df4fd1133774db90d2761ac59975ecaf1"))
}

func TestTemplateParse(t *testing.T) {
	//j := `{"test1":{"v1": 123}, "test2": [{"v2": "321"}]}`
	j := `{"cart_list":[{"coating":null,"product":{"is_glass":1,"is_sunglasses":2,"is_show_add_lense":1,"products_category_id":"2","product_lens":1,"shop_sku":"ZTX039428-02","short_name":"mj-01","img":"https://zeelool-us-3-test.s3.us-west-2.amazonaws.com/admin/product/image/1e5fb1741a7f1222a2a82531bfc795b1.jpg","frame_background_image":"","background_image_of_mirror_leg":"","color":"black","prescription_type":["Single Vision","Progressive","Reading Glasses","Non-Prescription"],"pd_min":"54","pd_max":"78","products_promotions_type":"0","price_info":[{"currency":"USD","price":"5.98","sell_price":"5.98"},{"currency":"EUR","price":"5.68","sell_price":"5.68"},{"currency":"AUD","price":"8.87","sell_price":"8.87"},{"currency":"GBP","price":"5.00","sell_price":"5.00"},{"currency":"CAD","price":"8.18","sell_price":"8.18"},{"currency":"xy","price":"0.00","sell_price":"0.00"},{"currency":"JPY","price":"783.79","sell_price":"783.79"}],"original_price":[{"currency":"USD","price":"5.98"},{"currency":"EUR","price":"5.68"},{"currency":"AUD","price":"8.87"},{"currency":"GBP","price":"5.00"},{"currency":"CAD","price":"8.18"},{"currency":"xy","price":"0.00"},{"currency":"JPY","price":"783.79"}],"is_gift":2,"limit_id":"0","limit_buy":0,"limit_rule":1,"limit_has_buy":"0","status":1,"is_wish":2,"same_color_spu":[],"exclusion":"{}"},"cart_id":7897055,"product_id":7448,"lens":{"lens_code":"10000000","lens_id":1,"lens_name":"Frame Only","lens_type":"Frame Only","lens_color":"","lens_index":"","refractive_index":"1.57","brand":"non","lens_type_price":[{"currency":"USD","price":"0.00","sell_price":"0.00"},{"currency":"EUR","price":"0.00","sell_price":"0.00"},{"currency":"AUD","price":"0.00","sell_price":"0.00"},{"currency":"GBP","price":"0.00","sell_price":"0.00"},{"currency":"CAD","price":"0.00","sell_price":"0.00"},{"currency":"xy","price":"0.00","sell_price":"0.00"},{"currency":"JPY","price":"0.00","sell_price":"0.00"}],"index_price":[{"currency":"USD","price":"0.00","sell_price":"0.00"},{"currency":"EUR","price":"0.00","sell_price":"0.00"},{"currency":"AUD","price":"0.00","sell_price":"0.00"},{"currency":"GBP","price":"0.00","sell_price":"0.00"},{"currency":"CAD","price":"0.00","sell_price":"0.00"},{"currency":"xy","price":"0.00","sell_price":"0.00"},{"currency":"JPY","price":"0.00","sell_price":"0.00"}],"lens_price":[{"currency":"USD","price":"0.00","sell_price":"0.00"},{"currency":"EUR","price":"0.00","sell_price":"0.00"},{"currency":"AUD","price":"0.00","sell_price":"0.00"},{"currency":"GBP","price":"0.00","sell_price":"0.00"},{"currency":"CAD","price":"0.00","sell_price":"0.00"},{"currency":"xy","price":"0.00","sell_price":"0.00"},{"currency":"JPY","price":"0.00","sell_price":"0.00"}],"is_match":1,"match_type":0},"option":{"pd":"","pd_l":"","pd_r":"","od_bd":"","od_pv":"","os_bd":"","os_pv":"","od_add":"","od_cyl":"","od_sph":"","os_add":"","os_cyl":"","os_sph":"","lens_id":1,"od_axis":"","od_bd_r":"","od_pv_r":"","os_axis":"","os_bd_r":"","os_pv_r":"","coating_id":0,"prescription_type":"Frame Only"},"qty":1,"stock":151,"created_at":"2023-04-25 02:30:26","product_price":"US $5.98","subtotal":"US $5.98"},{"coating":null,"product":{"is_glass":2,"is_sunglasses":2,"is_show_add_lense":1,"products_category_id":"30","product_lens":1,"shop_sku":"ZCH6056-01","short_name":"ZCH6056-01","img":"https://zeelool-us-3-test.s3.us-west-2.amazonaws.com/media/catalog/product/z/c/zch6056-01.jpg","frame_background_image":"","background_image_of_mirror_leg":"","color":"Pearl","prescription_type":[],"pd_min":"54","pd_max":"78","products_promotions_type":"1","price_info":[{"currency":"USD","price":"10.95","sell_price":"8.21"},{"currency":"EUR","price":"10.40","sell_price":"7.80"},{"currency":"AUD","price":"16.24","sell_price":"12.18"},{"currency":"GBP","price":"9.16","sell_price":"6.87"},{"currency":"CAD","price":"14.99","sell_price":"11.24"},{"currency":"xy","price":"0.00","sell_price":"0.00"},{"currency":"JPY","price":"1435.20","sell_price":"1076.07"}],"original_price":[{"currency":"USD","price":"9.86"},{"currency":"EUR","price":"9.36"},{"currency":"AUD","price":"14.63"},{"currency":"GBP","price":"8.25"},{"currency":"CAD","price":"13.50"},{"currency":"xy","price":"0.00"},{"currency":"JPY","price":"1292.33"}],"is_gift":2,"limit_id":"183","limit_buy":1,"limit_rule":4,"limit_has_buy":"0","status":1,"is_wish":2,"same_color_spu":[],"exclusion":{"half_price":2}},"cart_id":7896338,"product_id":3585,"lens":null,"option":{"pd":"","pd_l":"","pd_r":"","od_bd":"","od_pv":"","os_bd":"","os_pv":"","od_add":"","od_cyl":"","od_sph":"","os_add":"","os_cyl":"","os_sph":"","lens_id":0,"od_axis":"","od_bd_r":"","od_pv_r":"","os_axis":"","os_bd_r":"","os_pv_r":"","coating_id":0,"prescription_type":""},"qty":5,"stock":19,"created_at":"2023-03-16 01:48:17","product_price":"US $8.21","subtotal":"US $41.05"}],"recommend_list":[],"pc_domain":"https://test-www.zeelool.xmslol.cn","cdn_domain":"https://zeelool-us-3-test.s3.us-west-2.amazonaws.com"}`
	template := "<!DOCTYPE html>\n\n<html lang=\"en\">\n\n<head>\n\n    <meta charset=\"UTF-8\">\n\n    <title>Zeelool</title>\n\n</head>\n\n<body style=\"margin: 0; padding: 0;color: #333;background: white;\">\n\n\n\n    <!-- 更新购物车30分钟后未下单 -->\n\n\n\n    <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"600\" style=\"border-collapse: collapse; margin: 0 auto;\">\n\n        <tr>\n\n            <td height=\"84\" style=\"text-align: center;\">\n\n                <a\n                    href=\"{{ .pc_domain }}/?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\">\n\n                    <img src=\"{{ .cdn_domain }}/media/email/new/logo.png\" width=\"176\" alt=\"\">\n\n                </a>\n\n            </td>\n\n        </tr>\n\n        <tr>\n\n            <td>\n\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"600\" height=\"44\"\n                    style=\"border-collapse: collapse; margin: 0 auto; background: #333; text-align: center;\">\n\n                    <tr>\n\n                        <td style=\"width: 130px;  text-align: center; \">\n\n                            <a href=\"{{ .pc_domain }}/goods-list/80?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                style=\"padding-left: 20px; text-decoration: none;color: white; font-size: 16px;\">MEN</a>\n\n                        </td>\n\n                        <td>\n\n                            <a href=\"{{ .pc_domain }}/goods-list/116?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                style=\"text-decoration: none;color: white; font-size: 16px;\">HIGHLIGHT</a>\n\n                        </td>\n\n                        <td>\n\n                            <a href=\"{{ .pc_domain }}/goods-list/81?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                style=\"text-decoration: none;color: white; font-size: 16px;\">WOMEN</a>\n\n                        </td>\n\n                        <td style=\"width: 150px;  text-align: center; \">\n\n                            <a href=\"{{ .pc_domain }}/goods-list/119?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                style=\"padding-right: 10px; text-decoration: none; color: white; font-size: 16px;\">NEW\n                                IN</a>\n\n                        </td>\n\n                    </tr>\n\n                </table>\n\n            </td>\n\n        </tr>\n\n        <tr>\n\n            <td>\n\n                <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"600\"\n                    style=\"border-collapse: collapse; margin: 0 auto; background: #EAEFFF; text-align: center;\">\n\n                    <tr>\n\n                        <td>\n\n                            <a\n                                href=\"{{ .pc_domain }}/cart?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\">\n\n                                <img src=\"{{ .cdn_domain }}/media/oc_block/catalog/email_1004302/cart_30_minutes01.jpg\"\n                                    width=\"100%\" style=\"vertical-align: text-bottom;\">\n\n                            </a>\n\n                        </td>\n\n                    </tr>\n\n                    <tr>\n\n                        <td>\n\n                            <div style=\"margin: 50px 0 30px;text-align: center;font-size: 24px;font-weight: bold;\">\n                                WHAT'S IN YOUR CART!</div>\n\n                        </td>\n\n                    </tr>\n\n\n\n                    <tr>\n\n                        <td>\n\n                            <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"570\"\n                                style=\"border-collapse: collapse; margin: 0 auto; text-align: center;\">\n\n                                <tr>\n\n                                    {{ range $key, $cart := .cart_list }}\n\n                                    {{ if lt $key 3 }}\n\n                                    <td style=\"padding: 0 8px;\">\n\n                                        <a href=\"{{ $.pc_domain }}/cart?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                            style=\"text-decoration: none;\">\n\n                                            <div\n                                                style=\"width: 173px;min-height: 220px;box-sizing: border-box; padding: 13px 6px 10px; background: white;margin: 0 auto\">\n                                                <div\n                                                    style=\"width: 140px; height: 140px; box-sizing: border-box; margin: 0 auto;\">\n                                                    {{ if eq $cart.product.is_glass 1.0 }}\n                                                    <!-- 眼镜 -->\n                                                    <img src=\"{{ $cart.product.img }}\" width=\"140\"\n                                                        height=\"70\" style=\"margin-top: 25%;\" alt=\"\">\n                                                    {{ else }}\n                                                    <!-- 饰品 -->\n                                                    <img src=\"{{ $cart.product.img }}\" width=\"140\" alt=\"\">\n                                                    {{ end }}\n                                                </div>\n\n                                                <div\n                                                    style=\"padding-top: 8px; font-size: 19px; text-decoration: none; color: #333333;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;\">\n                                                    {{ $cart.product.short_name }}\n                                                </div>\n\n                                                <div style=\"font-size: 19px; text-decoration: none; color: #333333;\">\n                                                    {{ $cart.product_price }}1111\n                                                </div>\n\n                                            </div>\n\n                                        </a>\n\n                                    </td>\n\n                                    {{ end }}\n\n                                    {{ end }}\n\n                                </tr>\n\n                            </table>\n\n                        </td>\n\n                    </tr>\n\n                    <tr>\n\n                        <td>\n\n                            <a href=\"{{ .pc_domain }}/cart?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                style=\"text-decoration: none;\">\n\n                                <div\n                                    style=\"width: 288px;line-height: 48px;border: 2px solid #3C65C8;box-sizing: border-box;margin: 40px auto 63px;font-weight: bold;color: #3C65C8;\">\n                                    VIEW MORE</div>\n\n                            </a>\n\n                        </td>\n\n                    </tr>\n\n\n\n                    <tr>\n\n                        <td>\n\n                            <div style=\"margin: 0 0 30px;text-align: center;font-size: 24px;font-weight: bold;\">YOU\n                                MIGHT ALSO LIKE</div>\n\n                        </td>\n\n                    </tr>\n\n\n\n                    <tr>\n\n                        <td>\n\n                            <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"570\"\n                                style=\"border-collapse: collapse; margin: 0 auto; text-align: center;\">\n\n                                <tr>\n\n                                    {{ range .recommend_list }}\n\n                                    <td style=\"padding: 0 8px;\">\n\n                                        <a href=\"{{ .pc_domain }}/goods-detail/{{ .shop_sku }}?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                            style=\"text-decoration: none;\">\n\n                                            <div\n                                                style=\"width: 173px; margin: 0 auto; box-sizing: border-box; padding: 26px 6px 10px; background: white;\">\n\n                                                <img src=\"{{ .image_url }}\" width=\"160\" alt=\"\">\n\n                                                <div\n                                                    style=\"padding-top: 14px; font-size: 19px; text-decoration: none; color: #333333;\">\n                                                    {{ .price }}\n                                                </div>\n\n                                            </div>\n\n                                        </a>\n\n                                    </td>\n\n                                   {{ end }}\n\n                                </tr>\n\n                            </table>\n\n                        </td>\n\n                    </tr>\n\n\n\n                    <tr>\n\n                        <td style=\"padding: 48px 0;\">\n\n                            <a href=\"{{ .pc_domain }}/goods-list/81?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                style=\"text-decoration: none;\">\n\n                                <div\n                                    style=\"margin: 0 auto; width: 288px;border-radius: 24px; line-height: 48px; text-align: center; font-weight: bold; font-size: 19px;color: white; text-decoration: none; background: #3C65C8;\">\n                                    LEARN MORE</div>\n\n                            </a>\n\n                        </td>\n\n                    </tr>\n\n\n\n                    <tr>\n\n                        <td>\n\n                            <table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"600\"\n                                style=\"border-collapse: collapse; margin: 0 auto; text-align: center; background: white;\">\n\n                                <tr style=\"background: black\">\n\n                                    <td width=\"340\" style=\"padding-left: 24px; text-align: left;\">\n\n                                        <div\n                                            style=\"font-size: 18px; color: white;  padding-top: 20px; padding-bottom: 18px;\">\n                                            Find us</div>\n\n                                        <div style=\"padding-bottom: 13px;\">\n\n                                            <a href=\"https://www.facebook.com/zeelooloptical?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                                style=\" text-decoration: none;\">\n\n                                                <img src=\"{{ .cdn_domain }}/media/email/new/fb.png\" width=\"29\"\n                                                    alt=\"\">\n\n                                            </a>\n\n                                            <a href=\"https://www.instagram.com/zeelool?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                                style=\"display: inline-block; margin-left: 16px; text-decoration: none;\">\n\n                                                <img src=\"{{ .cdn_domain }}/media/email/new/ig.png\" width=\"29\"\n                                                    alt=\"\">\n\n                                            </a>\n\n                                        </div>\n\n                                    </td>\n\n                                    <td style=\"text-align: left;\">\n\n                                        <div\n                                            style=\"font-size: 18px; color: white; padding-top: 20px; padding-bottom: 18px;\">\n                                            APP</div>\n\n                                        <div style=\" padding-bottom: 14px;\">\n\n                                            <a href=\"https://apps.apple.com/us/app/zeelool/id1478850874?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                                style=\"display: inline-block; margin-right: 16px; text-decoration: none;\">\n\n                                                <img src=\"{{ .cdn_domain }}/media/email/new/app_store.png\"\n                                                    width=\"96\" alt=\"\">\n\n                                            </a>\n\n                                            <a href=\"https://play.google.com/store/apps/details?id=com.nextmar.zeelool.android?utm_source=TemplateMarketing&utm_medium=market&utm_campaign=updatecart30m\"\n                                                style=\" text-decoration: none;\">\n\n                                                <img src=\"{{ .cdn_domain }}/media/email/new/google_play.png\"\n                                                    width=\"96\" alt=\"\">\n\n                                            </a>\n\n                                        </div>\n\n                                    </td>\n\n                                </tr>\n\n                                <tr>\n\n                                    <td colspan=\"2\" style=\"text-align: center; height: 110px;\">\n\n                                        <div\n                                            style=\"text-align: center; font-size: 18px; color: #666; line-height: 30px;\">\n\n                                            Email us: support@zeelool.com <br>\n\n                                            NEXTMARVEL INCAddress: 5900 BALCONES DRIVE SUITE 100，AUSTIN, TX 78731\n\n                                        </div>\n\n                                    </td>\n\n                                </tr>\n\n                            </table>\n\n                        </td>\n\n                    </tr>\n\n                </table>\n\n            </td>\n\n        </tr>\n\n    </table>\n\n</body>\n\n</html>"

	var v = make(map[string]interface{})
	_ = json.Unmarshal([]byte(j), &v)
	_, err := TemplateParse(v, template)
	if err != nil {
		t.Error(err)
	}
}
